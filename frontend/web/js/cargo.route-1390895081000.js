$(function(){});$(window).load(function(){mGoogleApi.onLoadCallback=function(){showCargoRoute();mGoogleApi.autoComplete("destination-from",function(autocomplete){showCargoRoute();var place=autocomplete.getPlace();if(!place.geometry){return;}$("#from-lat").val(place.geometry.location.lat());$("#from-lng").val(place.geometry.location.lng());$("#from-zip").val(getZipFromPlace(place));resetPricesBlock();});mGoogleApi.autoComplete("destination-to",function(autocomplete){showCargoRoute();var place=autocomplete.getPlace();if(!place.geometry){return;}$("#to-lat").val(place.geometry.location.lat());$("#to-lng").val(place.geometry.location.lng());$("#to-zip").val(getZipFromPlace(place));resetPricesBlock();});$(".transit-via-block .transit-via-input").each(function(index,elem){mGoogleApi.autoComplete($(elem).attr("id"),viaAutoCompleteFunction);});};mGoogleApi.load(utils.getAppLang());});function getZipFromPlace(place){if(!place.address_components){return false;}var addr=place.address_components;var zip="";for(var i in addr){if(addr[i].types&&addr[i].types[0]=="postal_code"){zip=addr[i]["short_name"];break;}}return zip;}function showCargoRoute(){var request={origin:$("#destination-from").val(),destination:$("#destination-to").val(),travelMode:google.maps.DirectionsTravelMode.DRIVING};if(getViaPoints().length){var wayPoints=[],viaPoints=getViaPoints();for(var i in viaPoints){wayPoints.push({location:viaPoints[i],stopover:true});}request.waypoints=wayPoints;}mGoogleApi.directionsCallback=function(resp){$("#route-distance").val(mGoogleApi.getRouteDuration(resp));};mGoogleApi.directions(request);}function getViaPoints(){var points=[],rootElem=$(".text-row.transit-via-block");if(!rootElem.is(":empty")){rootElem.each(function(index,elem){points.push($(elem).find("input:first").val());});}return points;}function getViaPointForAutoComplete(){$(".transit-via-block .transit-via-input").each(function(index,elem){mGoogleApi.autoComplete($(elem).attr("id"),viaAutoCompleteFunction);});}